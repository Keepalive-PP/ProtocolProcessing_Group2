\begin{DoxyAuthor}{Authors}
\begin{DoxyItemize}
\item Antti Siirilä, 501449, \href{mailto:anjosi@utu.fi}{\tt anjosi@utu.\-fi}\item Heikki Juva\item Iiro Räsänen \end{DoxyItemize}

\end{DoxyAuthor}
\begin{DoxyDate}{Date}
13.\-5.\-2013 
\end{DoxyDate}
\hypertarget{index_s_intro}{}\section{Introduction}\label{index_s_intro}
B\-G\-P is a vital part of the Internet providing routing services between autonomous system. The goal of this projecs was to get familiar with the B\-G\-P protocol through a programming project. The programming projects contained the design and implementation of a B\-G\-P simulator. The design contains two main components the \hyperlink{classSimulation}{Simulation} and the User \hyperlink{classInterface}{Interface} (\hyperlink{namespaceUI}{U\-I}). The implementation of the \hyperlink{classSimulation}{Simulation} bases on System\-C where as the \hyperlink{namespaceUI}{U\-I} was implemeted with Python. \hypertarget{index_s_design}{}\section{Design}\label{index_s_design}
The architecture of the B\-G\-P simulator has devided in two modules\-: User \hyperlink{classInterface}{Interface} (\hyperlink{namespaceUI}{U\-I}) implemented with Python, and \hyperlink{classSimulation}{Simulation} implemented with the System\-C. The figure 1 illustrates the modules and their interconnection.  The \hyperlink{namespaceUI}{U\-I} allows the user to setup the simulation environment including the number of routers, the network topology, and the router configurations. Once the simulation configuration is setup, it is sent to the sc\-\_\-main through the T\-C\-P socket. The sc\-\_\-main is responsiple on building the simulation environment according to the configuration data received from the \hyperlink{namespaceUI}{U\-I}. Once the sc\-\_\-main has elaborated the \hyperlink{classSimulation}{Simulation}, it passes the T\-C\-P socket handle to the \hyperlink{classSimulation}{Simulation} and start the System\-C kernel. From there on the B\-G\-P simulation stars and the \hyperlink{namespaceUI}{U\-I} is able to receive simulation status over the T\-C\-P link by using a defined set of commands (\hyperlink{GUIProtocolTags_8hpp}{G\-U\-I\-Protocol\-Tags.\-hpp}). \hypertarget{index_sub_Simulation}{}\subsection{Simulation}\label{index_sub_Simulation}
The simulation module (figure 2) comprises of network nodes and their interconnection. Each network node contains the \hyperlink{classRouter}{Router} and \hyperlink{classHost}{Host} modules. The host module represents the local A\-S and can be used to send and receive I\-P packets to/from other A\-Ses.  The figure 3 defines the submodules and their relations inside the router module. The main modules are Data and Control planes, Routing table, and network Interfaces.  The number of network interfaces of the \hyperlink{classRouter}{Router} is defined to four. Three of the interfaces are dedicated for B\-G\-P peer connections and the remaining one connects to the host module. Each \hyperlink{classInterface}{Interface} has receiving and forwarding buffers. The \hyperlink{classDataPlane}{Data\-Plane} (D\-P) module handles the I\-P packet and B\-G\-P message forwarding. It connects to the receiving and forwarding buffers of all interfaces. In addition the D\-P connect to the \hyperlink{classRoutingTable}{Routing\-Table} (R\-T), which allows it to resolve routes for I\-P packets. Furhtermore, the D\-P passes all the B\-G\-P message to the \hyperlink{classControlPlane}{Control\-Plane} (C\-P) module and provides an interface for B\-G\-P message forwarding. I\-P packets are processed on bitlevel by \hyperlink{classPacketProcessor}{Packet\-Processor} submodule. The forwarding function includes the I\-P packet validation, destination resolving, T\-T\-L decrementation, and checksum recalculation processes. The C\-P has three B\-G\-P sessions for each B\-G\-P adjacent interface as submodules. \hyperlink{classControlPlane}{Control\-Plane} simply distributes the received B\-G\-P messages to the correct b\-G\-P session. The \hyperlink{classBGPSession}{B\-G\-P\-Session} module controls the B\-G\-P session states and timers. Once the peer interface of B\-G\-P session comes up, the session tries to establish a connection with the adjacent B\-G\-P router. The connection states follows the B\-G\-P specification (\href{https://en.wikipedia.org/wiki/Border_Gateway_Protocol}{\tt https\-://en.\-wikipedia.\-org/wiki/\-Border\-\_\-\-Gateway\-\_\-\-Protocol}). Once the connection is successfully established including the B\-G\-P O\-P\-E\-N message exchange, the B\-G\-P session transitions to the E\-S\-T\-A\-B\-L\-I\-S\-H\-E\-D state. In E\-S\-T\-A\-B\-L\-I\-S\-H\-E\-D state the B\-G\-P session simply sends keepalives, if required, and forwards B\-G\-P U\-P\-D\-A\-T\-E messages to the \hyperlink{classRoutingTable}{Routing\-Table} (R\-T). Whenever the hold-\/down timer expires or a N\-O\-T\-I\-F\-I\-C\-A\-T\-I\-O\-N message is received, the \hyperlink{classBGPSession}{B\-G\-P\-Session} invalidates and transition to the I\-D\-L\-E state. The \hyperlink{classRoutingTable}{Routing\-Table} module builds the B\-G\-P routing table based on the local A\-S information and the received B\-G\-P U\-P\-D\-A\-T\-E messages. R\-T listens the \hyperlink{classBGPSession}{B\-G\-P\-Session} states and updates the routing table and generates required U\-P\-D\-A\-T\-E messages in case of change in state. In addition, R\-T reads the U\-P\-D\-A\-T\-E messages from the input buffer and does the required table updates according to B\-G\-P specification and local policies. \hypertarget{index_sub_UI}{}\subsection{User Interface}\label{index_sub_UI}
\hypertarget{index_s_conclusion}{}\section{Conclusion}\label{index_s_conclusion}
In this programming exercise, a B\-G\-P network simulator was designed, and implemented using Python and System\-C. The B\-G\-P cold start and table update processes were successfully simulated for start topologies. The I\-P packet processesing was implemented on bitlevel as specified in R\-F\-C 1812. The I\-P packet routing was also simulated by sending test packets between A\-Ses. \hypertarget{index_sub_futureImprovements}{}\subsection{Future Improvements}\label{index_sub_futureImprovements}
Some of the basic functionality such as withdrawing a route and avoiding routing loops was not successfully simulated due to some bugs in the R\-T module. The simulation of the previously mentioned functions of B\-G\-P would require a thorough debugging of R\-T and perhaps a redesign of some of its components. In addition, implementing some experimental B\-G\-P functionalites such as security improvments would be interesting to simulate in the future. \hypertarget{index_sub_whatwelearned}{}\subsection{What We Learned}\label{index_sub_whatwelearned}
